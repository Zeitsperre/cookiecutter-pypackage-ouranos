[tox]
envlist = py{35,36,37,38}, pypy, black, docs, hooks

[travis]
python =
    3.7: black
    3.7: docs
    3.7: hooks
    pypy3 : pypy

[testenv]
setenv =
    PYTHONPATH = {toxinidir}:{toxinidir}/{{ cookiecutter.repo_name }}
deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/requirements_dev.txt
    pytest
commands =
    pytest --basetemp={envtmpdir} test

[testenv:black]
deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/requirements_dev.txt
    black
commands =
    flake8 {{ cookiecutter.repo_name }} test
    black --check {{ cookiecutter.repo_name }} test

[testenv:hooks]
passenv = SSH_AUTH_SOCK
deps = pre-commit
commands =
    pre-commit install
    pre-commit run --origin HEAD --source origin/HEAD
    pre-commit run --all-files

[testenv:docs]
changedir=docs/
deps =
    -r{toxinidir}/requirements.txt
    sphinx
commands =
    pip install {{ cookiecutter.repo_name }}[docs]
    - sphinx-build -b linkcheck ./ _build/
    sphinx-build -b html ./ _build/
